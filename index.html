<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>yã¯xã«æ¯”ä¾‹ 4æŠã‚¯ã‚¤ã‚ºï¼ˆæ•´æ•°ãƒ»åˆ†æ•°å¯¾å¿œï¼‰</title>
<style>
  body { font-family: Arial; text-align: center; background-color: #f0f8ff; }
  button { font-size: 20px; padding: 10px 20px; margin: 10px; cursor: pointer; }
  #question { font-size: 24px; margin: 20px 0; }
  #score { font-size: 20px; margin: 10px 0; }
</style>
</head>
<body>

<h1>yã¯xã«æ¯”ä¾‹ 4æŠã‚¯ã‚¤ã‚º</h1>

<div id="question"></div>
<div id="choices"></div>
<div id="score"></div>

<script>
let score = 0;
let questionCount = 0;
const totalQuestions = 5;
let k, x0, y0;

// åˆ†æ•°ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«ç”Ÿæˆã™ã‚‹é–¢æ•°
function randomFraction() {
    let numerator = Math.floor(Math.random() * 9) - 4; // -4ã€œ4
    let denominator = Math.floor(Math.random() * 5) + 1; // 1ã€œ5
    if (numerator === 0) numerator = 1;
    return `${numerator}/${denominator}`;
}

// åˆ†æ•°ã‚’æ•°å€¤ã«å¤‰æ›
function fractionToNumber(frac) {
    if (typeof frac === "number") return frac;
    if (typeof frac === "string" && frac.includes("/")) {
        let parts = frac.split('/');
        return parseInt(parts[0])/parseInt(parts[1]);
    }
    return parseFloat(frac);
}

// æ¯”ä¾‹å®šæ•°ã‚’ãƒ©ãƒ³ãƒ€ãƒ ç”Ÿæˆï¼ˆæ•´æ•°ã¾ãŸã¯åˆ†æ•°ï¼‰
function generateK() {
    if (questionCount < 3) {
        // 1å•ç›®ã€œ3å•ç›®ã¯æ•´æ•°
        let val = 0;
        while (val === 0) val = Math.floor(Math.random() * 11) - 5;
        return val;
    } else {
        // 4å•ç›®ã€œ5å•ç›®ã¯æ•´æ•°ã‹åˆ†æ•°
        if (Math.random() < 0.5) {
            let val = 0;
            while (val === 0) val = Math.floor(Math.random() * 11) - 5;
            return val;
        } else {
            return randomFraction();
        }
    }
}

// k ã‚’è¡¨ç¤ºç”¨ã«å¤‰æ›
function formatK(k) {
    if (fractionToNumber(k) === 1) return "x";
    if (fractionToNumber(k) === -1) return "-x";
    if (typeof k === "string" && k === "1/1") return "x";
    return `${k}x`;
}

function generateQuestion() {
    x0 = Math.floor(Math.random() * 10) + 1;
    k = generateK();
    y0 = fractionToNumber(k) * x0;

    document.getElementById("question").innerText = `yã¯xã«æ¯”ä¾‹ã™ã‚‹ã€‚x = ${x0}ã®ã¨ãã€y = ${y0}ã€‚yã‚’xã®å¼ã§è¡¨ã›ã€‚`;

    // é¸æŠè‚¢ä½œæˆ
    let choices = [k];
    while (choices.length < 4) {
        let option;
        if (questionCount < 3) {
            // æ•´æ•°
            let val = Math.round(fractionToNumber(k) + (Math.random() * 5 - 2));
            if (val === 0) val = 1; // 0ã¯é¿ã‘ã‚‹
            option = val;
        } else {
            // æ•´æ•°ã¾ãŸã¯åˆ†æ•°
            if (Math.random() < 0.5) {
                let val = Math.round(fractionToNumber(k) + (Math.random() * 5 - 2));
                if (val === 0) val = 1;
                option = val;
            } else {
                option = randomFraction();
            }
        }
        if (!choices.includes(option)) choices.push(option);
    }

    choices.sort(() => Math.random() - 0.5);

    let choicesDiv = document.getElementById("choices");
    choicesDiv.innerHTML = "";
    choices.forEach(val => {
        let btn = document.createElement("button");
        btn.innerText = `y = ${formatK(val)}`;
        btn.onclick = () => checkAnswer(val);
        choicesDiv.appendChild(btn);
    });
}

function checkAnswer(selected) {
    if (fractionToNumber(selected) === fractionToNumber(k)) {
        score++;
        alert("æ­£è§£ï¼ğŸ‰");
    } else {
        alert(`ä¸æ­£è§£ã€‚æ­£è§£ã¯ y = ${formatK(k)} ã§ã™ã€‚`);
    }
    questionCount++;
    if (questionCount < totalQuestions) {
        generateQuestion();
    } else {
        document.getElementById("question").innerText = `çµ‚äº†ï¼ã‚ãªãŸã®å¾—ç‚¹: ${score}/${totalQuestions}`;
        document.getElementById("choices").innerHTML = "";
    }
    document.getElementById("score").innerText = `å¾—ç‚¹: ${score}`;
}

generateQuestion();
</script>

</body>
</html>
